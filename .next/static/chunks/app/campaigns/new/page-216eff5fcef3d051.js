(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[387],{8786:function(e,t,a){Promise.resolve().then(a.bind(a,2443))},2443:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return Z}});var s=a(7437),r=a(2265),i=a(4033),n=a(1865),l=a(8110),d=a(2160),o=a(6091),c=a(1657);let m=r.forwardRef((e,t)=>{let{className:a,type:r,...i}=e;return(0,s.jsx)("input",{type:r,className:(0,c.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",a),ref:t,...i})});m.displayName="Input";var u=a(6743);let p=(0,a(6061).j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),f=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(u.f,{ref:t,className:(0,c.cn)(p(),a),...r})});f.displayName=u.f.displayName;var x=a(4083),h=a(3523),g=a(9224),b=a(2442);let j=x.fC;x.ZA;let y=x.B4,v=r.forwardRef((e,t)=>{let{className:a,children:r,...i}=e;return(0,s.jsxs)(x.xz,{ref:t,className:(0,c.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",a),...i,children:[r,(0,s.jsx)(x.JO,{asChild:!0,children:(0,s.jsx)(h.Z,{className:"h-4 w-4 opacity-50"})})]})});v.displayName=x.xz.displayName;let N=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(x.u_,{ref:t,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",a),...r,children:(0,s.jsx)(g.Z,{className:"h-4 w-4"})})});N.displayName=x.u_.displayName;let w=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(x.$G,{ref:t,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",a),...r,children:(0,s.jsx)(h.Z,{className:"h-4 w-4"})})});w.displayName=x.$G.displayName;let _=r.forwardRef((e,t)=>{let{className:a,children:r,position:i="popper",...n}=e;return(0,s.jsx)(x.h_,{children:(0,s.jsxs)(x.VY,{ref:t,className:(0,c.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===i&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",a),position:i,...n,children:[(0,s.jsx)(N,{}),(0,s.jsx)(x.l_,{className:(0,c.cn)("p-1","popper"===i&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r}),(0,s.jsx)(w,{})]})})});_.displayName=x.VY.displayName,r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(x.__,{ref:t,className:(0,c.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",a),...r})}).displayName=x.__.displayName;let k=r.forwardRef((e,t)=>{let{className:a,children:r,...i}=e;return(0,s.jsxs)(x.ck,{ref:t,className:(0,c.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...i,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(x.wU,{children:(0,s.jsx)(b.Z,{className:"h-4 w-4"})})}),(0,s.jsx)(x.eT,{children:r})]})});k.displayName=x.ck.displayName,r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(x.Z0,{ref:t,className:(0,c.cn)("-mx-1 my-1 h-px bg-muted",a),...r})}).displayName=x.Z0.displayName;var C=a(4930),S=a.n(C);a(1851);let E=S()(()=>Promise.all([a.e(70),a.e(889)]).then(a.t.bind(a,6233,23)),{loadableGenerated:{webpack:()=>[6233]},ssr:!1});function F(e){let{value:t,onChange:a,template:i,placeholder:n="Start writing your email content..."}=e,l=(0,r.useMemo)(()=>({toolbar:[[{header:[1,2,3,!1]}],["bold","italic","underline"],[{list:"ordered"},{list:"bullet"}],["link","image"],[{align:[]}],[{color:[]},{background:[]}],["clean"]]}),[]),d=(0,r.useCallback)(e=>{a(e)},[a]);return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("div",{className:"min-h-[300px] bg-white rounded-lg border",children:(0,s.jsx)(E,{theme:"snow",value:t,onChange:d,modules:l,formats:["header","bold","italic","underline","list","bullet","link","image","align","color","background"],placeholder:(()=>{switch(i){case"newsletter":return"Write your newsletter content here. You can include updates, news, and valuable information for your subscribers...";case"promotional":return"Create your promotional content here. Highlight your offer, benefits, and include a clear call-to-action...";case"welcome":return"Welcome your new subscribers! Introduce yourself, set expectations, and provide helpful getting started information...";default:return n}})(),className:"h-full email-editor",style:{height:"280px"}})}),i&&(0,s.jsxs)("div",{className:"text-sm text-gray-600 bg-blue-50 p-3 rounded-md",children:[(0,s.jsxs)("strong",{children:["Template: ",i]}),(0,s.jsx)("br",{}),"newsletter"===i&&"Perfect for regular updates and news sharing.","promotional"===i&&"Great for announcements, offers, and marketing campaigns.","welcome"===i&&"Ideal for greeting new subscribers and setting expectations."]}),(0,s.jsxs)("div",{className:"text-xs text-gray-500",children:[(0,s.jsx)("strong",{children:"Tips:"})," Use headings to structure your content, keep paragraphs short for better readability, and include links to drive engagement. Images should be web-optimized and have alt text."]})]})}let R=[{id:"newsletter",name:"Newsletter",description:"Perfect for regular updates, news, and content sharing",preview:"Clean, readable layout with header and structured content sections",icon:"\uD83D\uDCF0"},{id:"promotional",name:"Promotional",description:"Ideal for marketing campaigns, offers, and announcements",preview:"Eye-catching design with prominent call-to-action button",icon:"\uD83C\uDFAF"},{id:"welcome",name:"Welcome",description:"Great for onboarding new subscribers and setting expectations",preview:"Warm, inviting design with highlights and getting started info",icon:"\uD83D\uDC4B"}];function T(e){var t,a;let{selectedTemplate:r,onTemplateChange:i}=e;return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:R.map(e=>(0,s.jsxs)("div",{className:(0,c.cn)("relative rounded-lg border-2 p-4 cursor-pointer transition-all hover:shadow-md",r===e.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"),onClick:()=>i(e.id),children:[(0,s.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,s.jsx)("div",{className:"text-2xl",children:e.icon}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("h3",{className:"font-semibold text-gray-900",children:e.name}),(0,s.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:e.description}),(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-2",children:e.preview})]})]}),r===e.id&&(0,s.jsx)("div",{className:"absolute top-2 right-2",children:(0,s.jsx)("div",{className:"w-4 h-4 bg-blue-500 rounded-full flex items-center justify-center",children:(0,s.jsx)("svg",{className:"w-3 h-3 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})})]},e.id))}),r&&(0,s.jsxs)("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg",children:[(0,s.jsxs)("h4",{className:"font-medium text-gray-900 mb-2",children:["Selected: ",null===(t=R.find(e=>e.id===r))||void 0===t?void 0:t.name]}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:null===(a=R.find(e=>e.id===r))||void 0===a?void 0:a.description})]})]})}let z=d.Ry({name:d.Z_().min(1,"Campaign name is required").max(255),subject:d.Z_().min(1,"Subject is required").max(255),content:d.Z_().min(1,"Content is required"),template_id:d.Km(["newsletter","promotional","welcome"]).optional(),email_list_id:d.Z_().uuid("Please select an email list")});function P(e){let{emailLists:t,onSubmit:a,onSendNow:i,isLoading:d=!1,isSending:c=!1,initialData:u}=e,[p,x]=(0,r.useState)((null==u?void 0:u.template_id)||"newsletter"),{register:h,handleSubmit:g,setValue:b,watch:N,formState:{errors:w}}=(0,n.cI)({resolver:(0,l.F)(z),defaultValues:{name:(null==u?void 0:u.name)||"",subject:(null==u?void 0:u.subject)||"",content:(null==u?void 0:u.content)||"",template_id:(null==u?void 0:u.template_id)||"newsletter",email_list_id:(null==u?void 0:u.email_list_id)||""}}),C=N("content"),S=async e=>{await a(e)},E=async e=>{i&&await i(e)};return(0,s.jsxs)("div",{className:"space-y-8",children:[(0,s.jsxs)("form",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(f,{htmlFor:"name",children:"Campaign Name"}),(0,s.jsx)(m,{id:"name",...h("name"),placeholder:"Enter campaign name",className:w.name?"border-red-500":""}),w.name&&(0,s.jsx)("p",{className:"text-sm text-red-500",children:w.name.message})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(f,{htmlFor:"subject",children:"Email Subject"}),(0,s.jsx)(m,{id:"subject",...h("subject"),placeholder:"Enter email subject",className:w.subject?"border-red-500":""}),w.subject&&(0,s.jsx)("p",{className:"text-sm text-red-500",children:w.subject.message})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(f,{htmlFor:"email_list",children:"Email List"}),(0,s.jsxs)(j,{onValueChange:e=>{b("email_list_id",e,{shouldValidate:!0})},defaultValue:null==u?void 0:u.email_list_id,children:[(0,s.jsx)(v,{className:w.email_list_id?"border-red-500":"",children:(0,s.jsx)(y,{placeholder:"Select an email list"})}),(0,s.jsx)(_,{children:t.map(e=>(0,s.jsxs)(k,{value:e.id,children:[e.name," (",e.subscriber_count," subscribers)"]},e.id))})]}),w.email_list_id&&(0,s.jsx)("p",{className:"text-sm text-red-500",children:w.email_list_id.message})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(f,{children:"Email Template"}),(0,s.jsx)(T,{selectedTemplate:p,onTemplateChange:e=>{x(e),b("template_id",e,{shouldValidate:!0})}})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(f,{htmlFor:"content",children:"Email Content"}),(0,s.jsx)(F,{value:C,onChange:e=>{b("content",e,{shouldValidate:!0})},template:p}),w.content&&(0,s.jsx)("p",{className:"text-sm text-red-500",children:w.content.message})]}),(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 pt-4",children:[(0,s.jsx)(o.z,{type:"button",variant:"outline",onClick:g(S),disabled:d||c,className:"flex-1",children:d?"Saving...":"Save as Draft"}),i&&(0,s.jsx)(o.z,{type:"button",onClick:g(E),disabled:d||c,className:"flex-1",children:c?"Sending...":"Send Now"})]})]}),C&&p&&(0,s.jsxs)("div",{className:"border-t pt-8",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Preview"}),(0,s.jsx)("div",{className:"border rounded-lg p-4 bg-gray-50",children:(0,s.jsxs)("div",{className:"bg-white rounded-md p-6 max-w-2xl mx-auto",children:[(0,s.jsxs)("div",{className:"text-sm text-gray-500 mb-2",children:["Template: ",p]}),(0,s.jsx)("div",{className:"text-lg font-semibold mb-4",children:N("subject")||"Email Subject"}),(0,s.jsx)("div",{className:"prose prose-sm max-w-none",dangerouslySetInnerHTML:{__html:C}})]})})]})]})}function Z(){let e=(0,i.useRouter)(),[t,a]=(0,r.useState)([]),[n,l]=(0,r.useState)(!1),[d,o]=(0,r.useState)(!1),[c,m]=(0,r.useState)(!0),[u,p]=(0,r.useState)(null);(0,r.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/lists");if(!e.ok)throw Error("Failed to fetch email lists");let t=await e.json();a(t.emailLists||[])}catch(e){console.error("Error fetching email lists:",e),p("Failed to load email lists")}finally{m(!1)}})()},[]);let f=async t=>{l(!0),p(null);try{let a=await fetch("/api/campaigns",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!a.ok){let e=await a.json();throw Error(e.error||"Failed to create campaign")}let s=await a.json();e.push("/campaigns/".concat(s.campaign.id))}catch(e){console.error("Error creating campaign:",e),p(e instanceof Error?e.message:"Failed to create campaign")}finally{l(!1)}},x=async t=>{o(!0),p(null);try{let a=await fetch("/api/campaigns",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!a.ok){let e=await a.json();throw Error(e.error||"Failed to create campaign")}let s=(await a.json()).campaign.id,r=await fetch("/api/campaigns/".concat(s,"/send"),{method:"POST"});if(!r.ok){let e=await r.json();throw Error(e.error||"Failed to send campaign")}let i=await r.json();alert("Campaign sent successfully! ".concat(i.results.successful," emails sent.")),e.push("/campaigns/".concat(s))}catch(e){console.error("Error sending campaign:",e),p(e instanceof Error?e.message:"Failed to send campaign")}finally{o(!1)}};return c?(0,s.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Loading email lists..."})]})}):0===t.length?(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"No Email Lists Found"}),(0,s.jsx)("p",{className:"text-gray-600 mb-6",children:"You need at least one email list with subscribers to create a campaign."}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Please set up your email lists in your Supabase database first."})]}):(0,s.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Create New Campaign"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Design and send beautiful email campaigns to your subscribers."})]}),u&&(0,s.jsx)("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-md",children:(0,s.jsx)("p",{className:"text-red-800",children:u})}),(0,s.jsx)("div",{className:"bg-white rounded-lg border shadow-sm p-6",children:(0,s.jsx)(P,{emailLists:t,onSubmit:f,onSendNow:x,isLoading:n,isSending:d})})]})}},6091:function(e,t,a){"use strict";a.d(t,{z:function(){return o}});var s=a(7437),r=a(2265),i=a(7256),n=a(6061),l=a(1657);let d=(0,n.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),o=r.forwardRef((e,t)=>{let{className:a,variant:r,size:n,asChild:o=!1,...c}=e,m=o?i.g7:"button";return(0,s.jsx)(m,{className:(0,l.cn)(d({variant:r,size:n,className:a})),ref:t,...c})});o.displayName="Button"},1657:function(e,t,a){"use strict";a.d(t,{cn:function(){return i}});var s=a(7042),r=a(4769);function i(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,r.m6)((0,s.W)(t))}}},function(e){e.O(0,[271,868,971,938,744],function(){return e(e.s=8786)}),_N_E=e.O()}]);